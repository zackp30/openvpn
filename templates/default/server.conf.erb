# OpenVPN server configuration file
# Generated by Chef - local changes will be overwritten!

# Meta: Date:<%= Time.now.utc.to_s %>

# Please refer to the OpenVPN documentation for details on
# configuration settings.

<%- @config.sort.each do |key, values| -%>
<%- [*values].each do |value| -%>
<%- next if value.nil? -%>
<%=
case key
when "server_port"
    "port" # a different client port is used from the server port
when "port"
    "#" # comment the rest
else
    key
end
%> <%=
  case value
  when String
    value
  when TrueClass
    1
  when FalseClass
    0
  else
    value
  end
%>
<%- end -%>
<%- end -%>

<% unless @push_routes.empty? %>
# additional routes to push to clients
  <% @push_routes.each do |route| %>
push "route <%= route %>"
  <% end %>
<% end %>

<% unless @push_options.empty? %>
# additional options to push to clients
  <% render_push_options(@push_options).each do |line| -%>
<%= line %>
  <% end -%>
<% end %>
verb 3
<% if @static_addrs %>
client-config-dir /etc/openvpn/ccd
<% end %>
client-to-client

topology subnet
